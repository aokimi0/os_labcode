# UCore 操作系统实验资源汇总

## 官方实验资源

### 实验指导书

- **在线实验手册**：http://oslab.mobisys.cc/lab2025/_book/index.html
- **实验资源主页**：http://oslab.mobisys.cc/
- **清华大学操作系统实验室**：参考清华大学计算机系相关课程资源

### 课程网站（需校园网访问）

- **操作系统课程主页**：清华大学计算机系操作系统课程平台
- **实验提交系统**：课程管理系统实验提交入口
- **在线答疑平台**：课程讨论论坛

## 开发工具下载

### RISC-V 工具链

#### SiFive Freedom Tools（推荐）

- **下载地址**：https://github.com/sifive/freedom-tools/releases
- **版本**：v2020.12 - riscv64-unknown-elf-toolchain-10.2.0-2020.12.8-x86_64-linux-ubuntu14
- **直接下载链接**：
  ```
  https://static.dev.sifive.com/dev-tools/freedom-tools/v2020.12/riscv64-unknown-elf-toolchain-10.2.0-2020.12.8-x86_64-linux-ubuntu14.tar.gz
  ```

#### 其他工具链选项

- **官方 RISC-V GNU Toolchain**：https://github.com/riscv/riscv-gnu-toolchain
- **预编译版本**：https://riscv.org/pages/tools/

### 系统仿真器

#### QEMU

- **官方网站**：https://www.qemu.org/
- **Ubuntu 安装**：

  ```bash
  sudo apt install qemu-system-riscv64
  ```

- **源码编译安装**（如需要最新版本）：
  ```bash
  git clone https://git.qemu.org/git/qemu.git
  cd qemu
  ./configure --target-list=riscv64-softmmu
  make
  sudo make install
  ```

### 调试工具

#### GDB

- **Ubuntu 安装**：
  ```bash
  sudo apt install gdb
  ```
- **RISC-V GDB**：通常包含在 RISC-V 工具链中

## 实验代码和框架

### 实验代码仓库

- **UCore 实验室代码**：本项目包含完整的实验代码框架
- **参考答案**：实验完成后可与提供的参考实现对比分析

### 代码结构

```
lab1/                    # 内核启动实验
├── kern/               # 内核核心代码
│   ├── init/          # 初始化模块
│   ├── driver/        # 设备驱动
│   ├── libs/          # 基础库函数
│   └── mm/            # 内存管理（基础）
├── tools/             # 构建工具
└── Makefile          # 构建脚本

lab2/                  # 物理内存管理
├── kern/mm/          # 内存管理实现
└── libs/             # 数据结构支持

lab3/                  # 中断处理
├── kern/trap/        # 中断处理
├── kern/debug/       # 调试支持
├── kern/driver/      # 设备驱动（含时钟）
└── kern/sync/        # 同步机制
```

## 参考书籍和资料

### 操作系统原理

- **《操作系统概念》（Operating System Concepts）** - Abraham Silberschatz 等著
- **《现代操作系统》（Modern Operating Systems）** - Andrew S. Tanenbaum 著
- **《操作系统导论》（Operating System: Three Easy Pieces）** - Remzi H. Arpaci-Dusseau 著

### RISC-V 架构

- **《计算机组成与设计：硬件/软件接口》（RISC-V 版）** - David A. Patterson 等著
- **RISC-V 规格说明书**：https://riscv.org/technical/specifications/
- **RISC-V 读者**：https://riscv.org/risc-v-reader/

### 系统编程

- **《深入理解计算机系统》（CSAPP）** - Randal E. Bryant 等著
- **《Unix 环境高级编程》** - W. Richard Stevens 等著

## 在线技术资源

### RISC-V 社区

- **RISC-V 官方网站**：https://riscv.org/
- **RISC-V 基金会**：https://riscv.org/foundation/
- **RISC-V GitHub**：https://github.com/riscv

### 开源操作系统

- **Linux 内核**：https://kernel.org/
- **FreeBSD**：https://www.freebsd.org/
- **xv6 教学操作系统**：https://github.com/mit-pdos/xv6-riscv

### 技术博客和教程

- **操作系统课程博客**：参考清华大学和国内外知名高校的操作系统课程博客
- **CSDN 操作系统专区**：https://blog.csdn.net/nav/os
- **知乎操作系统话题**：https://www.zhihu.com/topic/19551315

## 实验环境配置详解

### Ubuntu 环境配置脚本

```bash
#!/bin/bash
# 一键配置脚本

# 更新包管理器
sudo apt update
sudo apt upgrade -y

# 安装基本开发工具
sudo apt install -y build-essential git wget curl

# 安装 QEMU 和依赖
sudo apt install -y qemu-system-riscv64
sudo apt install -y libglib2.0-dev libpixman-1-dev

# 安装 RISC-V 工具链
TOOLCHAIN_URL="https://static.dev.sifive.com/dev-tools/freedom-tools/v2020.12/riscv64-unknown-elf-toolchain-10.2.0-2020.12.8-x86_64-linux-ubuntu14.tar.gz"
wget $TOOLCHAIN_URL
sudo tar -xzf $(basename $TOOLCHAIN_URL) -C /opt
rm $(basename $TOOLCHAIN_URL)

# 配置环境变量
echo 'export RISCV=/opt/riscv' >> ~/.bashrc
echo 'export PATH=$RISCV/bin:$PATH' >> ~/.bashrc

# 刷新环境变量
source ~/.bashrc

# 验证安装
echo "验证工具链..."
riscv64-unknown-elf-gcc -v
echo "验证 QEMU..."
qemu-system-riscv64 --version

echo "环境配置完成！"
```

### Docker 环境（备选方案）

```dockerfile
FROM ubuntu:20.04

RUN apt update && apt install -y \
    build-essential \
    git \
    wget \
    qemu-system-riscv64 \
    libglib2.0-dev \
    libpixman-1-dev

# 安装 RISC-V 工具链
RUN wget https://static.dev.sifive.com/dev-tools/freedom-tools/v2020.12/riscv64-unknown-elf-toolchain-10.2.0-2020.12.8-x86_64-linux-ubuntu14.tar.gz \
    && tar -xzf riscv64-unknown-elf-toolchain-10.2.0-2020.12.8-x86_64-linux-ubuntu14.tar.gz -C /opt \
    && rm riscv64-unknown-elf-toolchain-10.2.0-2020.12.8-x86_64-linux-ubuntu14.tar.gz

ENV RISCV=/opt/riscv
ENV PATH=$RISCV/bin:$PATH

WORKDIR /workspace
```

## 调试技巧

### QEMU 调试模式启动

```bash
# 调试模式
qemu-system-riscv64 \
    -machine virt \
    -nographic \
    -bios default \
    -device loader,file=bin/ucore.img,addr=0x80200000 \
    -s -S

# 在另一个终端运行 GDB
riscv64-unknown-elf-gdb \
    -ex 'file bin/kernel' \
    -ex 'set arch riscv:rv64' \
    -ex 'target remote localhost:1234'
```

### 常用 GDB 命令

```bash
# 设置断点
b function_name
b *address

# 单步执行
step (s)
next (n)

# 继续执行
continue (c)

# 查看信息
info registers
info breakpoints
x /10x $pc

# 查看内存
x /20xw address
```

## 实验测试和验证

### 内存分配算法测试

- 使用内核提供的测试框架验证算法正确性
- 观察不同算法的时间和空间效率差异

### 中断处理测试

- 验证中断响应时间
- 测试异常处理机制
- 检查时钟中断频率准确性

### 系统性能测试

- 内存分配释放的性能基准测试
- 中断延迟测量
- 系统吞吐量测试

## 常见问题解决方案

### 1. 工具链问题

**问题**：`riscv64-unknown-elf-gcc: command not found`
**解决**：

```bash
# 检查工具链安装
ls /opt/riscv/bin/riscv64-unknown-elf-gcc

# 检查环境变量
echo $RISCV
echo $PATH

# 重新加载配置
source ~/.bashrc
```

### 2. QEMU 运行问题

**问题**：QEMU 无法启动或显示错误
**解决**：

```bash
# 检查 QEMU 版本
qemu-system-riscv64 --version

# 使用不同机器类型
qemu-system-riscv64 -machine virt -bios default

# 检查内核镜像
ls -la bin/ucore.img
```

### 3. 编译错误

**问题**：编译时出现语法错误或链接错误
**解决**：

```bash
# 清理编译产物
make clean

# 重新编译
make

# 检查依赖
make print-INCLUDE
make print-LIBDIR
```

## 实验进度跟踪

### Lab1 完成标志

- ✅ 成功编译内核
- ✅ 看到内核启动信息
- ✅ 理解启动流程

### Lab2 完成标志

- ✅ 理解 First-Fit 算法
- ✅ 实现 Best-Fit 算法
- ✅ 通过内存分配测试

### Lab3 完成标志

- ✅ 实现中断初始化
- ✅ 处理异常和中断
- ✅ 实现时钟功能

## 技术支持联系方式

- **课程教师**：操作系统课程任课教师邮箱
- **教学助手**：实验课助教联系方式
- **技术论坛**：课程内部讨论平台
- **在线答疑**：每周固定答疑时间

## 更新日志

- **2025.10**：初始版本发布
- **2025.XX**：根据实验进度更新资源链接

---

_实验资源汇总最后更新：2025 年 10 月_

_注：部分链接需要校园网或特定网络环境访问_
